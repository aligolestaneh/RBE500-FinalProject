<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RBE500 Final Project: RBE500-FinalProject</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RBE500 Final Project
   </div>
   <div id="projectbrief">ROS package for RBE500 Final Project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.html','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">RBE500-FinalProject </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__root_ros2_space_RBE500_final_project_ws_src_RBE500_FinalProject_README"></a> </p>
<h1><a class="anchor" id="autotoc_md1"></a>
Setup</h1>
<ol type="1">
<li>First Setup the Github , if you are using the git on your system for the first time, follow these links <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">1. Generate SSH Key for here</a>, <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account">2. Add to your github account</a></li>
<li>Create ROS2 workspace You may ignore this step if you have already a workspace available and jump to <code>setup step 2</code> with your own workspace directory ```bash $ mkdir -p ~/colcon_ws/src $ cd ~/colcon_ws/src ```</li>
<li>Setup Open Manipulator X ROS2 packages: ```bash $ git clone <a href="https://github.com/hylander2126/OpenManipulatorX_ROS2.git">https://github.com/hylander2126/OpenManipulatorX_ROS2.git</a> ```</li>
<li>Clone git repo in your ROS workspace (currently Private with team member access only) ```bash $ git clone <a href="#" onclick="location.href='mai'+'lto:'+'git'+'@g'+'ith'+'ub'+'.co'+'m'; return false;">git@g<span style="display: none;">.nosp@m.</span>ithu<span style="display: none;">.nosp@m.</span>b.com</a>:aligolestaneh/RBE500-FinalProject.git $ cd ~/colcon_ws $ rosdep install &ndash;from-paths src &ndash;ignore-src -r -y $ colcon build &ndash;symlink-install ``` </li>
</ol>
<h1><a class="anchor" id="autotoc_md2"></a>
Code Overview</h1>
<h2><a class="anchor" id="autotoc_md3"></a>
Packages</h2>
<h3><a class="anchor" id="autotoc_md4"></a>
rbe500_final_project_msgs</h3>
<p>It has custom srv and msgs definations required for the <code>rbe500_final_project</code> pkg. Currently it has a custom service defination to get the <code>joint_angles</code> from Inverse kinematics node.</p>
<h3><a class="anchor" id="autotoc_md5"></a>
rbe500_final_project</h3>
<p>A ROS2 package having all required nodes for the final project.</p>
<h4><a class="anchor" id="autotoc_md6"></a>
Core Libraries</h4>
<ul>
<li><code>manipulator_core_lib</code>: A C++ library independent of ROS2 which takes care of Forward and Inverse kinematics of the Open manipulator X. The DH parameters is hardcoded here but you can setup the link_lengths independently.</li>
<li><code>manipulator_fk_ros_lib</code>: A ROS2 wrapper library which utlizes the <code>manipulator_core_lib</code> to implement forward kinematics.<ul>
<li><b>Subscribed Topics</b>:<ul>
<li><code>/joint_state</code> (<a href="https://docs.ros2.org/latest/api/sensor_msgs/msg/JointState.html">sensor_msgs/msg/JointState</a>) : <b>joint angles</b> of the mainpulator in radians.</li>
</ul>
</li>
<li><b>Published Topics</b>:<ul>
<li><code>/end_effector_pose</code> (<a href="https://docs.ros2.org/latest/api/geometry_msgs/msg/PoseStamped.html">geometry_msgs/msg/PoseStamped</a>) : Publishes pose of the end_effector w.r.t <em>link_0</em> frame. Used Forward kinematics as per current DH params of the mainpulator to get the pose data.</li>
</ul>
</li>
</ul>
</li>
<li><code>manipulator_ik_ros_lib</code>: A ROS2 wrapper library which utlizes the <code>manipulator_core_lib</code> to implement inverse kinematics.<ul>
<li><b>Services</b>:<ul>
<li><code>/get_joint_angles_ik</code> (<em>rbe500_final_project_msgs/srv/GetJointAngles</em>) : It takes <em>end_effector pose</em> as request and respond calculated <em>joint_angles</em> .</li>
</ul>
</li>
</ul>
</li>
<li><code>manipulator_follow_actions_lib</code>: A ROS2 wrapper library which reads the action sequence from the <b>manipulator_actions.yaml</b> and move the manipulator as per the given sequence. It does it in three major steps:<ol type="1">
<li>If action type is <em>go_to_position</em> then:<ul>
<li>Calculate the <em>joint_angles</em> for the given pose using <b>manipulator_ik_ros_lib</b> service: <code>/get_joint_angles_ik</code>.</li>
<li>Moves manipualtor to the calculated joint_angles using <em>OpenManipulatorX</em> service <code>/goal_joint_space_path</code>.</li>
</ul>
</li>
<li>If action type is <em>open_gripper</em> or <em>close_gripper</em> then:<ul>
<li>Calls the <em>OpenManipulatorX</em> service <code>/goal_tool_control</code> to open and close gripper.</li>
</ul>
</li>
</ol>
<ul>
<li><b>Published Topics</b>:<ul>
<li><code>/goal_marker</code> (<a href="https://docs.ros2.org/latest/api/visualization_msgs/msg/Marker.html">visualization_msgs/msg/Marker</a>) : Publishes the current <code>go_to_position</code> pose as a sphere marker.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md7"></a>
Parameters</h2>
<ul>
<li><code>manipulator_core_pramas.yaml</code>: It has all the requried parameters for setting up <em>manipulator_core_lib</em> .<ol type="1">
<li><code>ik_max_iteration</code> :<ul>
<li>Type: Integer</li>
<li>Decription: Max interation to do for Newton Raphson Loop</li>
</ul>
</li>
<li><code>ik_tolerance</code>:<ul>
<li>Type: Double</li>
<li>Decription: Epsilon value to check convergance of Newton raphson method</li>
</ul>
</li>
<li><code>use_newton_raphson_ik</code>:<ul>
<li>Type: Bool</li>
<li>Decription: Set <code>TRUE</code> to use Netwon Raphson method ofr INverse kinematics.</li>
</ul>
</li>
<li><code>link_lengths</code>:<ul>
<li>Type: List of Paramters</li>
<li>Decription: List of link_length parameters, each having its name and Double type value</li>
</ul>
</li>
<li><code>manipulator_links</code>:<ul>
<li>Type: List of String</li>
<li>Decription: Link names to be used for setting the DH params. These names act as the parameter names of link_lengths vector. For ex: If LinkA has been mentioned , it will only read the <code>LinkA</code> parameter from the <code>link_lengths</code> paramter list.</li>
</ul>
</li>
</ol>
</li>
<li><code>manipulator_actions.yaml</code>: It contains poses and action sequence to move the manipualtor to various positions.<ul>
<li><p class="startli"><b>poses</b>: It has list of end effector pose (position and oreintation) w.r.t to <em>link_0</em>.</p>
<p class="startli">User can addd new poses as per this template: ```yaml poses: &lt;pose-name&gt;: position: x: &lt;double value&gt; y: &lt;double value&gt; z: &lt;double value&gt; orientation: x: &lt;double value&gt; y: &lt;double value&gt; z: &lt;double value&gt; w: &lt;double value&gt; ``<code> The best way is to directly copy paste the data from</code>/end_effector_pose<code>topic. For example: </code>``yaml poses: show_pick_obj: position: x: 0.006 y: 0.108 z: 0.266 orientation: x: 0.549 y: 0.445 z: -0.524 w: -0.476 <br  />
 ```</p>
</li>
<li><p class="startli"><b>actions</b>: It has a list of actions to be executed using <b>manipulator_follow_actions_lib</b> sequentially. Each action has following parameters:</p><ul>
<li><b>type(<em>string</em>)</b> : Type of the action will be single string from the following sets:<ul>
<li><em>go_to_position</em>: It moves the manipulator to the pose.</li>
<li><em>open_gripper</em>: It completely opens the gripper.</li>
<li><em>close_gripper</em>: It completely clsoes the gripper.</li>
</ul>
</li>
<li><b>position(<em>string</em>)</b>: Pose name corresponding to a pose specified in <em>poses</em> parameter. It gets used only if your action type is <em>go_to_position</em>.</li>
<li><b>wait(integer)</b>: Wait time in seconds after an action has been completed. If you don't mention it. The default value get set to 2 seconds automatically in the code.</li>
</ul>
<p class="startli">User can addd new <em>go_to_position</em> action as per this template: ```yaml actions:</p><ul>
<li>type: go_to_position position: home_position wait: 1</li>
</ul>
<p class="startli">OR actions:</p><ul>
<li>type: go_to_position position: home_position <br  />
 ``` User can addd new <em>open_gripper</em> action as per this template: ```yaml actions:</li>
<li>type: open_gripper wait: 1</li>
</ul>
<p class="startli">OR actions:</p><ul>
<li>type: open_gripper ``` User can addd new <em>close_gripper</em> action as per this template: ```yaml actions:</li>
<li>type: close_gripper wait: 1</li>
</ul>
<p class="startli">OR actions:</p><ul>
<li>type: close_gripper ```</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md8"></a>
Running Nodes</h1>
<h2><a class="anchor" id="autotoc_md9"></a>
Forward Kinematics:</h2>
<ol type="1">
<li>Launch the OpenX Manipulator control ```bash $ source ~/colcon_ws/install/setup.bash $ ros2 launch open_manipulator_x_controller open_manipulator_x_controller.launch.py ```</li>
<li>Launch Forward Kinematics Node: ```bash $ source ~/colcon_ws/install/setup.bash $ ros2 launch rbe500_final_project <a class="el" href="manipulator__fk__ros_8launch_8py.html">manipulator_fk_ros.launch.py</a> ```</li>
<li>Check End effector pose: ```bash $ ros2 topic echo /end_effector_pose ``` </li>
</ol>
<h2><a class="anchor" id="autotoc_md10"></a>
Inverse Kinematics:</h2>
<ol type="1">
<li>Launch the OpenX Manipulator control ```bash $ source ~/colcon_ws/install/setup.bash $ ros2 launch open_manipulator_x_controller open_manipulator_x_controller.launch.py ```</li>
<li>Launch Inverse Kinematics Node: ```bash $ source ~/colcon_ws/install/setup.bash $ ros2 launch rbe500_final_project <a class="el" href="manipulator__ik__ros_8launch_8py.html">manipulator_ik_ros.launch.py</a> ```</li>
<li>Get Joint Angles: ```bash $ source ~/colcon_ws/install/setup.bash $ ros2 service call /get_joint_angles_ik rbe500_final_project_msgs/srv/GetJointAngles "{end_effector_pose: {position: {x: 0.1, y: 0.2, z: 0.3}, orientation: {x: 0.0, y: 0.0, z: 0.0, w: 1.0}}}" ``` </li>
</ol>
<h2><a class="anchor" id="autotoc_md11"></a>
Pick and Place Action sequence:</h2>
<ol type="1">
<li>Launch the OpenX Manipulator control ```bash $ source ~/colcon_ws/install/setup.bash $ ros2 launch open_manipulator_x_controller open_manipulator_x_controller.launch.py ```</li>
<li>Launch Inverse Kinematics Node: ```bash $ source ~/colcon_ws/install/setup.bash $ ros2 launch rbe500_final_project <a class="el" href="manipulator__ik__ros_8launch_8py.html">manipulator_ik_ros.launch.py</a> ```</li>
<li>Execute Pick and Place action sequence ```bash $ source ~/colcon_ws/install/setup.bash $ ros2 run rbe500_final_project manipulator_follow_actions_node ```</li>
</ol>
<h1><a class="anchor" id="autotoc_md12"></a>
Writing Test Cases</h1>
<h2><a class="anchor" id="autotoc_md13"></a>
CMakelist Edits</h2>
<p>All test cases has been written up in the test folder. You may add your test cases aswell by creating your own test <code>cpp</code> file or editing the existing ones. Please don't edit <code><a class="el" href="main_8cpp.html">main.cpp</a></code>. Make sure you add it into <code>CMakelist.txt</code> in order to build your unit test code. </p><div class="fragment"><div class="line">set(TESTFILES</div>
<div class="line">  test/main.cpp</div>
<div class="line">  test/simple_test.cpp</div>
<div class="line">  test/&lt;your_test_file_name&gt;_test.cpp) #&lt;&lt;------ add here</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md14"></a>
Compiling and Test case results</h2>
<p>In order to view the test cases results and you need to build the package first: </p><div class="fragment"><div class="line">$ cd &lt;your-workspace&gt; </div>
<div class="line">$ colcon build --symlink-install --packages-select rbe500_final_project</div>
</div><!-- fragment --><p> Now you can build the test cases:</p><ol type="1">
<li>Compiling without test cases result verbose: ```bash $ colcon test &ndash;packages-select rbe500_final_project ```</li>
<li>Compiling the test cases along with result verbose: ```bash $ colcon test &ndash;packages-select rbe500_final_project &ndash;event-handler=console_direct+ ``` </li>
</ol>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
